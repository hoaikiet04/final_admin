<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- link css -->
    <link rel="stylesheet" href="./asset/css/reset.css" />
    <link rel="stylesheet" href="./asset/css/style.css" />
    <!-- link jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Thêm sửa xóa</title>
  </head>
  <body>
    <navbar class="navbar">
      <h1><a href="./index.html">Quản lý hệ thống</a></h1>
      <div class="search-bar">
        <input type="text" placeholder="Tìm kiếm cho ..." />
        <button>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 448 512"
            height="20px"
            margin="0 auto"
            fill="#28a745"
          >
            <path
              d="M384 432c8.8 0 16-7.2 16-16l0-320c0-8.8-7.2-16-16-16L64 80c-8.8 0-16 7.2-16 16l0 320c0 8.8 7.2 16 16 16l320 0zm64-16c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96C0 60.7 28.7 32 64 32l320 0c35.3 0 64 28.7 64 64l0 320zM224 352c-6.7 0-13-2.8-17.6-7.7l-104-112c-6.5-7-8.2-17.2-4.4-25.9s12.5-14.4 22-14.4l208 0c9.5 0 18.2 5.7 22 14.4s2.1 18.9-4.4 25.9l-104 112c-4.5 4.9-10.9 7.7-17.6 7.7z"
            />
          </svg>
        </button>
      </div>
    </navbar>

    <main>
      <div class="container">
        <!-- sidebar -->
        <aside class="sidebar">
          <!-- section custom tour -->
          <section>
            <h5>Cập nhật tour</h5>
            <div class="menu-items">
              <a href="./custom.html" data-page="custom.html">Chỉnh sửa tour</a>
              <a href="./category.html" data-page="category.html"
                >Danh mục tour</a
              >
            </div>
          </section>

          <!-- section manage list -->
          <section>
            <h5>Quản lý</h5>
            <div class="menu-items">
              <a href="./customer-list.html" data-page="customer-list.html"
                >Danh sách khách hàng</a
              >
              <a href="./booking-list.html" data-page="booking-list.html"
                >Danh sách đặt tour</a
              >
              <a href="./feedback.html" data-page="feedback.html">Phản hồi</a>
            </div>
          </section>
        </aside>

        <!-- main-content -->
        <div class="main-content" id="main-content">
          <!-- total Doanh thu -->
          <section class="total">
            <div class="total__item">
              <div class="total__card">
                <h5>Tổng Doanh Thu</h5>
                <a href="#">Xem chi tiết</a>
              </div>
            </div>

            <!-- total Khách hàng -->
            <div class="total__item">
              <div class="total__card">
                <h5>Tổng khách hàng</h5>
                <a href="#">Xem chi tiết</a>
              </div>
            </div>

            <!-- total Đơn hàng -->
            <div class="total__item">
              <div class="total__card">
                <h5>Tổng đơn hàng</h5>
                <a href="#">Xem chi tiết</a>
              </div>
            </div>

            <!-- total địa điểm -->
            <div class="total__item">
              <div class="total__card">
                <h5>Tổng địa điểm</h5>
                <a href="#">Xem chi tiết</a>
              </div>
            </div>
          </section>

          <!-- list  tour-->
          <section class="content-area">
            <div class="content-header">
              <h1>Cập nhật tour</h1>
              <button id="add-tour-btn" class="btn">Thêm mới</button>
            </div>

            <!-- Tours Grid -->
            <div class="tours-grid" id="tours-container">
              <!-- Sample tour cards (will be replaced with dynamic content) -->
              <div class="tour-card">
                <img
                  src="./asset/image/tour_card1.jpg"
                  alt="Ha Long Bay"
                  class="tour-image"
                />
                <div class="tour-info">
                  <h3 class="tour-title">Ha Long Bay Tour</h3>
                  <p class="tour-location">Quang Ninh, Vietnam</p>
                  <p class="tour-price">2,500,000 VNĐ</p>
                  <div class="tour-actions">
                    <button class="btn btn-edit">Sửa</button>
                    <button class="btn btn-danger">Xóa</button>
                  </div>
                </div>
              </div>

              <div class="tour-card">
                <img
                  src="./asset/image/tour_card2.jpg"
                  alt="Hoi An"
                  class="tour-image"
                />
                <div class="tour-info">
                  <h3 class="tour-title">Hoi An Ancient Town</h3>
                  <p class="tour-location">Quang Nam, Vietnam</p>
                  <p class="tour-price">1,800,000 VNĐ</p>
                  <div class="tour-actions">
                    <button class="btn btn-edit">Sửa</button>
                    <button class="btn btn-danger">Xóa</button>
                  </div>
                </div>
              </div>

              <div class="tour-card">
                <img
                  src="./asset/image/tour_card3.jpg"
                  alt="Sapa"
                  class="tour-image"
                />
                <div class="tour-info">
                  <h3 class="tour-title">Sapa Trekking</h3>
                  <p class="tour-location">Lao Cai, Vietnam</p>
                  <p class="tour-price">3,200,000 VNĐ</p>
                  <div class="tour-actions">
                    <button class="btn btn-edit">Sửa</button>
                    <button class="btn btn-danger">Xóa</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Loading indicator -->
            <div class="loading" id="loading-indicator">
              <div class="spinner"></div>
              <p>Loading tours...</p>
            </div>

            <!-- thêm tour khi ấn vào add tour xuất hiện form -->
            <div class="modal-overlay" id="add-tour-modal">
              <div class="modal">
                <div class="modal-header">
                  <h2>Thêm tour mới</h2>
                  <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                  <form id="add-tour-form">
                    <div class="form-group">
                      <label for="tour-title">Tên địa điểm</label>
                      <input
                        type="text"
                        id="tour-title"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="tour-location">Địa chỉ</label>
                      <input
                        type="text"
                        id="tour-location"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="tour-price">Giá (VNĐ)</label>
                      <input
                        type="number"
                        id="tour-price"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="tour-image">Image URL</label>
                      <input
                        type="text"
                        id="tour-image"
                        class="form-control"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="tour-description">Mô tả</label>
                      <textarea
                        id="tour-description"
                        class="form-control"
                        required
                      ></textarea>
                    </div>
                  </form>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-cancel" id="cancel-btn">Hủy</button>
                  <button class="btn" id="submit-btn">Thêm</button>
                </div>
              </div>
            </div>
            <script>
              $(document).ready(function () {
                // Sidebar toggle functionality
                $(".sidebar h5").click(function () {
                  $(this).toggleClass("collapsed");
                  $(this).next(".menu-items").stop(true, true).slideToggle(300);
                });

                // Modal functionality
                const $modal = $("#add-tour-modal");
                const $addTourBtn = $("#add-tour-btn");
                const $closeBtn = $(".modal-close");
                const $cancelBtn = $("#cancel-btn");
                const $submitBtn = $("#submit-btn");
                const $form = $("#add-tour-form");
                const $loadingIndicator = $("#loading-indicator");

                // Open modal
                $addTourBtn.on("click", function () {
                  $modal.addClass("active");
                });

                // Close modal
                function closeModal() {
                  $modal.removeClass("active");
                  $form[0].reset();
                }

                $closeBtn.on("click", closeModal);
                $cancelBtn.on("click", closeModal);

                // Close modal when clicking outside
                $modal.on("click", function (e) {
                  if (e.target === this) {
                    closeModal();
                  }
                });

                // Handle form submission
                $submitBtn.on("click", function () {
                  // Validate form
                  if (!$form[0].checkValidity()) {
                    $form[0].reportValidity();
                    return;
                  }

                  // Show loading indicator
                  $loadingIndicator.addClass("active");

                  // Collect form data
                  const formData = {
                    title: $("#tour-title").val(),
                    location: $("#tour-location").val(),
                    price: $("#tour-price").val(),
                    image: $("#tour-image").val(),
                    description: $("#tour-description").val(),
                  };

                  // Send AJAX request
                  $.ajax({
                    url: "add_tour.php",
                    type: "POST",
                    data: formData,
                    success: function (response) {
                      // Hide loading indicator
                      $loadingIndicator.removeClass("active");

                      // Close modal
                      closeModal();

                      // Show success message
                      alert("Tour added successfully!");

                      // Optionally refresh the tours list
                      // loadTours();
                    },
                    error: function (xhr, status, error) {
                      // Hide loading indicator
                      $loadingIndicator.removeClass("active");

                      // Show error message
                      alert("Error adding tour: " + error);
                    },
                  });
                });

                // Function to load tours (can be implemented later)
                function loadTours() {
                  $loadingIndicator.addClass("active");

                  $.ajax({
                    url: "get_tours.php",
                    type: "GET",
                    success: function (tours) {
                      // Clear existing tours
                      $("#tours-container").empty();

                      // Add new tours
                      tours.forEach(function (tour) {
                        const tourCard = `
                          <div class="tour-card" data-id="${tour.id}">
                            <img src="${tour.image}" alt="${
                          tour.title
                        }" class="tour-image">
                            <div class="tour-info">
                              <h3 class="tour-title">${tour.title}</h3>
                              <p class="tour-location">${tour.location}</p>
                              <p class="tour-price">${tour.price.toLocaleString()} VNĐ</p>
                              <div class="tour-actions">
                                <button class="btn btn-edit" data-id="${
                                  tour.id
                                }">Edit</button>
                                <button class="btn btn-danger" data-id="${
                                  tour.id
                                }">Delete</button>
                              </div>
                            </div>
                          </div>
                        `;
                        $("#tours-container").append(tourCard);
                      });

                      $loadingIndicator.removeClass("active");
                    },
                    error: function (xhr, status, error) {
                      $loadingIndicator.removeClass("active");
                      alert("Error loading tours: " + error);
                    },
                  });
                }

                // Handle edit and delete buttons (can be implemented later)
                $(document).on("click", ".btn-edit", function () {
                  const tourId = $(this).data("id");
                  // Implement edit functionality
                  console.log("Edit tour with ID:", tourId);
                });

                $(document).on("click", ".btn-danger", function () {
                  const tourId = $(this).data("id");
                  if (confirm("Are you sure you want to delete this tour?")) {
                    // Implement delete functionality
                    console.log("Delete tour with ID:", tourId);
                  }
                });
              });
            </script>
          </section>
        </div>
      </div>
    </main>
  </body>
</html>
